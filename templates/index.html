{% extends "base.html" %}

{% block content %}
    <div id="action-row">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div id="heavy-file-warning" style="display: none; background-color: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffeeba; text-align: left; font-size: 0.9em;">
            <strong>丘멆잺 Archivo pesado detectado:</strong> 
            Este PDF supera los 30MB. Para asegurar que el proceso termine con 칠xito en la nube, la <strong>Vista Previa</strong> ha sido deshabilitada.
            <br><em>Sugerencia: Puedes foliar directamente o usar la versi칩n local para previsualizar.</em>
        </div>

        <h1>Foliador PDF Web</h1>

        {% if not pdf_processor_available %}
        <div class="instruction-card full-width-card">
            <p><strong>丘멆잺 Advertencia:</strong> El procesador de PDF no est치 disponible en el servidor.</p>
        </div>
        {% endif %}
        
        <label id="drag-drop-label" for="pdf_file_drag" class="dropzone-large">
            <span class="drag-icon">游늬</span> 
            Arrastra tu archivo PDF aqu칤 o haz clic para seleccionar.
            <input type="file" id="pdf_file_drag" accept="application/pdf" style="display: none;">
        </label>
    </div>
    
    <div id="config-and-preview-section" style="display: none;">
        <form id="foliator-form" method="POST" enctype="multipart/form-data" action="{{ url_for('upload_file') }}">
            <input type="file" name="pdf_file" id="pdf_file" accept="application/pdf" style="display: none;">
            
            <div id="config-col-full">
                <h2>1. Configuraci칩n del Foliado</h2>
                <label for="start_number">N칰mero de folio inicial:</label>
                <input type="number" id="start_number" name="start_number" value="1" min="1" required>
                
                <div class="control-group-split">
                    <div>
                        <label for="start_page">P치gina inicial:</label>
                        <input type="number" id="start_page" name="start_page" value="1" min="1">
                    </div>
                    <div>
                        <label for="end_page">P치gina final:</label>
                        <input type="number" id="end_page" name="end_page">
                    </div>
                </div>
            </div>
            
            <div id="style-col-full">
                <h2>2. Estilo y Posici칩n</h2>
                <div class="control-group-split">
                    <div>
                        <label for="font_size">Tama침o Fuente:</label>
                        <input type="number" id="font_size" name="font_size" value="14" min="8" max="72">
                    </div>
                    <div>
                        <label for="offset">Margen (cm):</label>
                        <input type="number" id="offset" name="offset" value="1.0" min="0.5" max="5.0" step="0.1">
                    </div>
                </div>
                
                <div class="control-group-split">
                    <div>
                        <label for="corner">Posici칩n:</label>
                        <select id="corner" name="corner">
                            <option value="bottom-right" selected>Abajo - Derecha</option>
                            <option value="bottom-left">Abajo - Izquierda</option>
                            <option value="top-right">Arriba - Derecha</option>
                            <option value="top-left">Arriba - Izquierda</option>
                        </select>
                    </div>
                    <div>
                        <label for="orientation">Orientaci칩n:</label>
                        <select id="orientation" name="orientation">
                            <option value="horizontal" selected>Horizontal</option>
                            <option value="vertical">Vertical</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <button type="submit" id="submit-button" disabled>
                Foliar y Descargar PDF
            </button>
        </form>
        
        <div id="preview-col-right">
            <h2>3. Vista Previa</h2>
            <div id="preview-container">
                <p id="preview-message">Sube un PDF para ver la previsualizaci칩n.</p>
                <img id="preview-image" src="" alt="Vista previa" style="display:none; max-width: 100%;">
            </div>
        </div>
    </div>

    {% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // L칩gica de validaci칩n de tama침o de archivo
        const dragInput = document.getElementById('pdf_file_drag');
        const heavyWarning = document.getElementById('heavy-file-warning');
        
        dragInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const sizeMB = file.size / (1024 * 1024);
                // Si pesa m치s de 30MB, activamos la bandera global
                window.isHeavyFile = sizeMB > 30;
                heavyWarning.style.display = window.isHeavyFile ? 'block' : 'none';
            }
        });
    </script>
{% endblock %}